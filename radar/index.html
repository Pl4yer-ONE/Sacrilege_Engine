<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SACRILEGE RADAR - CS2 Demo Replayer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --accent-cyan: #00d4ff;
            --accent-magenta: #ff00aa;
            --accent-gold: #ffd700;
            --ct-color: #4a9eff;
            --t-color: #ffcc00;
            --text-primary: #ffffff;
            --text-secondary: #888899;
            --danger: #ff4444;
            --success: #44ff88;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Main Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 60px 1fr 80px;
            height: 100vh;
            gap: 1px;
            background: #2a2a35;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            border-bottom: 1px solid var(--accent-cyan);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .match-info {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 28px;
            font-weight: 700;
        }

        .score-ct {
            color: var(--ct-color);
            text-shadow: 0 0 20px var(--ct-color);
        }

        .score-t {
            color: var(--t-color);
            text-shadow: 0 0 20px var(--t-color);
        }

        .score-separator {
            color: var(--text-secondary);
        }

        .round-info {
            background: var(--bg-tertiary);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
        }

        /* Left Panel - Players */
        .players-panel {
            background: var(--bg-secondary);
            overflow-y: auto;
            padding: 16px;
        }

        .team-section {
            margin-bottom: 24px;
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .team-header.ct {
            background: rgba(74, 158, 255, 0.15);
            color: var(--ct-color);
            border-left: 3px solid var(--ct-color);
        }

        .team-header.t {
            background: rgba(255, 204, 0, 0.15);
            color: var(--t-color);
            border-left: 3px solid var(--t-color);
        }

        .player-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 6px;
            display: grid;
            grid-template-columns: 32px 1fr 60px;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .player-card:hover {
            border-color: var(--accent-cyan);
            transform: translateX(4px);
        }

        .player-card.dead {
            opacity: 0.4;
        }

        .player-card.selected {
            border-color: var(--accent-magenta);
            background: rgba(255, 0, 170, 0.1);
        }

        .player-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .player-icon.ct {
            background: linear-gradient(135deg, var(--ct-color), #2a6ecc);
            box-shadow: 0 0 10px var(--ct-color);
        }

        .player-icon.t {
            background: linear-gradient(135deg, var(--t-color), #cc9900);
            box-shadow: 0 0 10px var(--t-color);
        }

        .player-info {
            overflow: hidden;
        }

        .player-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-stats {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .player-health {
            text-align: right;
        }

        .health-bar {
            height: 4px;
            background: var(--bg-primary);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #22cc66);
            transition: width 0.3s;
        }

        .health-fill.low {
            background: linear-gradient(90deg, var(--danger), #cc2222);
        }

        /* Main Radar */
        .radar-container {
            background: var(--bg-primary);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .radar-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 800px;
            aspect-ratio: 1;
        }

        #radar-canvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }

        /* Radar Overlays */
        .radar-overlay {
            position: absolute;
            pointer-events: none;
        }

        .kill-feed {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .kill-entry {
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            animation: slideIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .kill-entry .killer {
            color: var(--ct-color);
        }

        .kill-entry .killer.t-team {
            color: var(--t-color);
        }

        .kill-entry .weapon {
            color: var(--text-secondary);
            font-size: 11px;
        }

        .kill-entry .victim {
            color: var(--danger);
        }

        .kill-entry .headshot {
            color: var(--accent-gold);
            font-weight: bold;
        }

        /* Right Panel - Events */
        .events-panel {
            background: var(--bg-secondary);
            overflow-y: auto;
            padding: 16px;
        }

        .panel-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .event-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid var(--accent-cyan);
        }

        .event-time {
            font-size: 11px;
            color: var(--accent-cyan);
            margin-bottom: 4px;
        }

        .event-text {
            font-size: 13px;
        }

        /* Legend */
        .legend {
            background: rgba(0, 0, 0, 0.8);
            position: absolute;
            bottom: 16px;
            left: 16px;
            padding: 12px 16px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            margin-bottom: 4px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Timeline */
        .timeline {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .playback-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-cyan);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            border: none;
        }

        .btn.primary:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .timeline-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s;
        }

        .timeline-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
        }

        .timeline-marker {
            position: absolute;
            width: 3px;
            height: 16px;
            top: -4px;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .timeline-marker.kill {
            background: var(--danger);
        }

        .timeline-marker.bomb {
            background: var(--accent-gold);
        }

        .time-display {
            font-family: monospace;
            font-size: 16px;
            min-width: 100px;
            text-align: center;
            background: var(--bg-tertiary);
            padding: 8px 16px;
            border-radius: 8px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .speed-btn {
            padding: 6px 12px;
            font-size: 12px;
        }

        .speed-btn.active {
            background: var(--accent-cyan);
            color: var(--bg-primary);
        }

        /* Round Navigator */
        .round-nav {
            display: flex;
            gap: 4px;
        }

        .round-btn {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 1px solid var(--bg-tertiary);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .round-btn:hover {
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }

        .round-btn.active {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            border-color: var(--accent-cyan);
        }

        .round-btn.ct-win {
            border-bottom: 3px solid var(--ct-color);
        }

        .round-btn.t-win {
            border-bottom: 3px solid var(--t-color);
        }

        /* Utility indicators */
        .utility-indicator {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        .smoke-indicator {
            background: radial-gradient(circle, rgba(200, 200, 200, 0.6), rgba(150, 150, 150, 0.3));
            animation: smokeFloat 3s infinite;
        }

        @keyframes smokeFloat {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.7;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.5;
            }
        }

        .molly-indicator {
            background: radial-gradient(circle, rgba(255, 100, 0, 0.8), rgba(255, 50, 0, 0.4));
            animation: mollyBurn 0.5s infinite;
        }

        @keyframes mollyBurn {

            0%,
            100% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }
        }

        .flash-indicator {
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9), transparent);
            animation: flashBang 0.2s;
        }

        @keyframes flashBang {
            0% {
                transform: scale(0);
                opacity: 1;
            }

            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        /* Loading state */
        .loading {
            position: absolute;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 24px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--bg-tertiary);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <span class="logo-text">SACRILEGE RADAR</span>
            </div>

            <div class="match-info">
                <div class="score-display">
                    <span class="score-ct" id="score-ct">8</span>
                    <span class="score-separator">:</span>
                    <span class="score-t" id="score-t">7</span>
                </div>
                <div class="round-info">
                    <span id="map-name">de_mirage</span> ‚Ä¢ Round <span id="current-round">16</span>/24
                </div>
            </div>

            <div class="round-nav" id="round-nav">
                <!-- Generated dynamically -->
            </div>
        </header>

        <!-- Left Panel - Players -->
        <aside class="players-panel">
            <div class="team-section">
                <div class="team-header ct">
                    <span>‚¨§</span> Counter-Terrorists
                </div>
                <div id="ct-players">
                    <!-- Generated dynamically -->
                </div>
            </div>
            <div class="team-section">
                <div class="team-header t">
                    <span>‚¨§</span> Terrorists
                </div>
                <div id="t-players">
                    <!-- Generated dynamically -->
                </div>
            </div>
        </aside>

        <!-- Main Radar -->
        <main class="radar-container">
            <div class="radar-wrapper">
                <canvas id="radar-canvas" width="800" height="800"></canvas>

                <!-- Kill Feed Overlay -->
                <div class="kill-feed" id="kill-feed"></div>

                <!-- Legend -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--ct-color);"></div>
                        <span>CT Player</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--t-color);"></div>
                        <span>T Player</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--danger);"></div>
                        <span>Bomb</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(200,200,200,0.6);"></div>
                        <span>Smoke</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(255,100,0,0.8);"></div>
                        <span>Molotov</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Panel - Events -->
        <aside class="events-panel">
            <div class="panel-title">Round Events</div>
            <div id="events-list">
                <!-- Generated dynamically -->
            </div>
        </aside>

        <!-- Timeline -->
        <footer class="timeline">
            <div class="playback-controls">
                <button class="btn" id="btn-prev">‚èÆ</button>
                <button class="btn primary" id="btn-play">‚ñ∂ Play</button>
                <button class="btn" id="btn-next">‚è≠</button>
            </div>

            <div class="timeline-bar" id="timeline-bar">
                <div class="timeline-progress" id="timeline-progress"></div>
                <div class="timeline-markers" id="timeline-markers"></div>
            </div>

            <div class="time-display">
                <span id="current-time">0:00</span> / <span id="total-time">1:55</span>
            </div>

            <div class="speed-control">
                <span style="color: var(--text-secondary); font-size: 12px;">Speed:</span>
                <button class="btn speed-btn" data-speed="0.5">0.5x</button>
                <button class="btn speed-btn active" data-speed="1">1x</button>
                <button class="btn speed-btn" data-speed="2">2x</button>
                <button class="btn speed-btn" data-speed="4">4x</button>
            </div>
        </footer>
    </div>

    <script>
        // ============================================
        // SACRILEGE RADAR - CS2 Demo Replayer
        // ============================================

        class RadarReplayer {
            constructor() {
                this.canvas = document.getElementById('radar-canvas');
                this.ctx = this.canvas.getContext('2d');

                // State
                this.isPlaying = false;
                this.playbackSpeed = 1;
                this.currentTick = 0;
                this.totalTicks = 7680; // ~2 mins at 64 tick
                this.tickRate = 64;

                // Demo data (will be loaded from JSON)
                this.demoData = null;
                this.players = [];
                this.smokes = [];
                this.mollies = [];
                this.kills = [];

                // Map settings
                this.mapName = 'de_mirage';
                this.mapConfig = this.getMapConfig('de_mirage');

                // Animation
                this.animationId = null;
                this.lastFrameTime = 0;

                this.init();
            }

            getMapConfig(mapName) {
                const configs = {
                    'de_mirage': {
                        origin: { x: -3230, y: 1713 },
                        scale: 5.0,
                        bounds: { minX: -3230, maxX: 1800, minY: -3400, maxY: 1713 }
                    },
                    'de_dust2': {
                        origin: { x: -2476, y: 3239 },
                        scale: 4.4,
                        bounds: { minX: -2476, maxX: 2108, minY: -1250, maxY: 3239 }
                    },
                    'de_inferno': {
                        origin: { x: -2087, y: 3870 },
                        scale: 4.9,
                        bounds: { minX: -2087, maxX: 2500, minY: -800, maxY: 3870 }
                    }
                };
                return configs[mapName] || configs['de_mirage'];
            }

            init() {
                this.setupEventListeners();
                this.loadSampleData();
                this.render();
            }

            setupEventListeners() {
                // Play button
                document.getElementById('btn-play').addEventListener('click', () => {
                    this.togglePlay();
                });

                // Prev/Next buttons
                document.getElementById('btn-prev').addEventListener('click', () => {
                    this.seekRound(-1);
                });
                document.getElementById('btn-next').addEventListener('click', () => {
                    this.seekRound(1);
                });

                // Timeline click
                document.getElementById('timeline-bar').addEventListener('click', (e) => {
                    const rect = e.target.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    this.currentTick = Math.floor(percent * this.totalTicks);
                    this.render();
                });

                // Speed controls
                document.querySelectorAll('.speed-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.playbackSpeed = parseFloat(btn.dataset.speed);
                    });
                });

                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.togglePlay();
                    } else if (e.code === 'ArrowLeft') {
                        this.currentTick = Math.max(0, this.currentTick - 64);
                        this.render();
                    } else if (e.code === 'ArrowRight') {
                        this.currentTick = Math.min(this.totalTicks, this.currentTick + 64);
                        this.render();
                    }
                });
            }

            loadSampleData() {
                // Generate sample player data for demo
                this.players = [
                    // CT
                    { id: '1', name: 'keen', team: 'CT', health: 100, armor: 100, x: -400, y: -1800, angle: 90, isAlive: true, weapon: 'AK-47', hasBomb: false, isFlashed: false, slot: 1 },
                    { id: '2', name: 'hazr', team: 'CT', health: 76, armor: 100, x: -200, y: -1600, angle: 45, isAlive: true, weapon: 'M4A1-S', hasBomb: false, isFlashed: false, slot: 2 },
                    { id: '3', name: 'SaVage', team: 'CT', health: 100, armor: 50, x: 0, y: -600, angle: 180, isAlive: true, weapon: 'AWP', hasBomb: false, isFlashed: false, slot: 3 },
                    { id: '4', name: 'ADDICT', team: 'CT', health: 45, armor: 0, x: 300, y: -400, angle: -90, isAlive: true, weapon: 'M4A4', hasBomb: false, isFlashed: true, slot: 4 },
                    { id: '5', name: 'sqreet', team: 'CT', health: 0, armor: 0, x: -800, y: 200, angle: 0, isAlive: false, weapon: 'USP-S', hasBomb: false, isFlashed: false, slot: 5 },
                    // T
                    { id: '6', name: 'labreen', team: 'T', health: 100, armor: 100, x: -1600, y: -2800, angle: 0, isAlive: true, weapon: 'AK-47', hasBomb: true, slot: 1 },
                    { id: '7', name: 'shadiy', team: 'T', health: 88, armor: 100, x: -1400, y: -2600, angle: 30, isAlive: true, weapon: 'AK-47', hasBomb: false, slot: 2 },
                    { id: '8', name: 'makaroff', team: 'T', health: 0, armor: 0, x: -1000, y: -2000, angle: 60, isAlive: false, weapon: 'Glock', hasBomb: false, slot: 3 },
                    { id: '9', name: 'AZIZZ', team: 'T', health: 100, armor: 100, x: -2000, y: -1000, angle: 90, isAlive: true, weapon: 'AWP', hasBomb: false, slot: 4 },
                    { id: '10', name: 'r1cq', team: 'T', health: 54, armor: 25, x: -1800, y: -800, angle: 120, isAlive: true, weapon: 'AK-47', hasBomb: false, slot: 5 },
                ];

                // Sample utility
                this.smokes = [
                    { x: -500, y: -800, startTick: 1000, endTick: 5000, radius: 40 },
                    { x: 200, y: 400, startTick: 2000, endTick: 6000, radius: 40 },
                ];

                this.mollies = [
                    { x: -100, y: -1200, startTick: 3000, endTick: 4000, radius: 30 },
                ];

                // Sample kills
                this.kills = [
                    { tick: 1500, killer: 'keen', victim: 'shadiy', weapon: 'M4A1-S', headshot: false, killerTeam: 'CT' },
                    { tick: 2500, killer: 'labreen', victim: 'sqreet', weapon: 'AK-47', headshot: true, killerTeam: 'T' },
                    { tick: 4000, killer: 'SaVage', victim: 'makaroff', weapon: 'AWP', headshot: true, killerTeam: 'CT' },
                    { tick: 5500, killer: 'AZIZZ', victim: 'ADDICT', weapon: 'AWP', headshot: true, killerTeam: 'T' },
                    { tick: 6000, killer: 'hazr', victim: 'r1cq', weapon: 'M4A1-S', headshot: false, killerTeam: 'CT' },
                ];

                // Round events for panel
                this.roundEvents = [
                    { tick: 0, type: 'round_start', text: 'Round 16 Started' },
                    { tick: 1000, type: 'smoke', text: 'labreen threw smoke (T Spawn)' },
                    { tick: 1500, type: 'kill', text: 'keen ‚ü∂ shadiy (M4A1-S)' },
                    { tick: 2000, type: 'flash', text: 'AZIZZ threw flashbang (A Main)' },
                    { tick: 2500, type: 'kill', text: 'labreen ‚ü∂ sqreet (AK-47) ‚¨§HS' },
                    { tick: 3000, type: 'molotov', text: 'r1cq threw molotov (Connector)' },
                    { tick: 4000, type: 'kill', text: 'SaVage ‚ü∂ makaroff (AWP) ‚¨§HS' },
                    { tick: 4500, type: 'bomb', text: 'labreen planting bomb (A Site)' },
                    { tick: 5500, type: 'kill', text: 'AZIZZ ‚ü∂ ADDICT (AWP) ‚¨§HS' },
                    { tick: 6000, type: 'kill', text: 'hazr ‚ü∂ r1cq (M4A1-S)' },
                ];

                // Update UI
                this.updatePlayerPanels();
                this.generateRoundNav();
                this.populateEventsPanel();
            }

            populateEventsPanel() {
                const container = document.getElementById('events-list');
                container.innerHTML = '';

                this.roundEvents.forEach(event => {
                    const card = document.createElement('div');
                    card.className = 'event-card';

                    const typeColors = {
                        'round_start': '#00d4ff',
                        'kill': '#ff4444',
                        'smoke': '#888888',
                        'flash': '#ffffff',
                        'molotov': '#ff6600',
                        'bomb': '#ffd700'
                    };
                    card.style.borderLeftColor = typeColors[event.type] || '#00d4ff';

                    const seconds = Math.floor(event.tick / 64);
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;

                    card.innerHTML = `
                        <div class="event-time">${mins}:${secs.toString().padStart(2, '0')}</div>
                        <div class="event-text">${event.text}</div>
                    `;
                    container.appendChild(card);
                });
            }

            updatePlayerPanels() {
                const ctContainer = document.getElementById('ct-players');
                const tContainer = document.getElementById('t-players');

                ctContainer.innerHTML = '';
                tContainer.innerHTML = '';

                this.players.forEach(player => {
                    const card = document.createElement('div');
                    card.className = `player-card ${!player.isAlive ? 'dead' : ''}`;
                    card.innerHTML = `
                        <div class="player-icon ${player.team.toLowerCase()}">${player.slot}</div>
                        <div class="player-info">
                            <div class="player-name">${player.name}</div>
                            <div class="player-stats">${player.weapon}${player.hasBomb ? ' üí£' : ''}</div>
                        </div>
                        <div class="player-health">
                            <span>${player.isAlive ? player.health : '‚ò†'}</span>
                            <div class="health-bar">
                                <div class="health-fill ${player.health <= 30 ? 'low' : ''}" style="width: ${player.health}%"></div>
                            </div>
                        </div>
                    `;

                    if (player.team === 'CT') {
                        ctContainer.appendChild(card);
                    } else {
                        tContainer.appendChild(card);
                    }
                });
            }

            generateRoundNav() {
                const nav = document.getElementById('round-nav');
                nav.innerHTML = '';

                for (let i = 1; i <= 24; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'round-btn';
                    if (i <= 8) btn.classList.add('ct-win');
                    else if (i <= 15) btn.classList.add('t-win');
                    else btn.classList.add('ct-win');
                    if (i === 16) btn.classList.add('active');
                    btn.textContent = i;
                    btn.addEventListener('click', () => this.goToRound(i));
                    nav.appendChild(btn);
                }
            }

            togglePlay() {
                this.isPlaying = !this.isPlaying;
                const btn = document.getElementById('btn-play');
                btn.textContent = this.isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play';

                if (this.isPlaying) {
                    this.lastFrameTime = performance.now();
                    this.animate();
                }
            }

            animate() {
                if (!this.isPlaying) return;

                const now = performance.now();
                const delta = (now - this.lastFrameTime) / 1000;
                this.lastFrameTime = now;

                // Update tick based on playback speed
                this.currentTick += Math.floor(this.tickRate * this.playbackSpeed * delta);

                if (this.currentTick >= this.totalTicks) {
                    this.currentTick = this.totalTicks;
                    this.isPlaying = false;
                    document.getElementById('btn-play').textContent = '‚ñ∂ Play';
                }

                // Update player positions (simulated movement)
                this.simulateMovement(delta);

                this.render();
                this.animationId = requestAnimationFrame(() => this.animate());
            }

            simulateMovement(delta) {
                // Simulate slight player movement for demo
                this.players.forEach(player => {
                    if (player.isAlive) {
                        player.x += (Math.random() - 0.5) * 10 * delta;
                        player.y += (Math.random() - 0.5) * 10 * delta;
                        player.angle += (Math.random() - 0.5) * 20 * delta;
                    }
                });
            }

            render() {
                const ctx = this.ctx;
                const canvas = this.canvas;

                // Clear canvas
                ctx.fillStyle = '#0d1117';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw map background (simplified grid)
                this.drawMapBackground();

                // Draw utility
                this.drawUtility();

                // Draw players
                this.drawPlayers();

                // Draw bomb
                this.drawBomb();

                // Update timeline
                this.updateTimeline();

                // Update kill feed
                this.updateKillFeed();
            }

            drawMapBackground() {
                const ctx = this.ctx;
                const canvas = this.canvas;

                // Simple grid background
                ctx.strokeStyle = 'rgba(50, 50, 70, 0.3)';
                ctx.lineWidth = 1;

                const gridSize = 50;
                for (let x = 0; x < canvas.width; x += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }
                for (let y = 0; y < canvas.height; y += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                // Draw callout areas
                this.drawCalloutAreas();
            }

            drawCalloutAreas() {
                const ctx = this.ctx;

                // A Site
                ctx.fillStyle = 'rgba(74, 158, 255, 0.1)';
                ctx.fillRect(300, 100, 180, 180);
                ctx.fillStyle = 'rgba(74, 158, 255, 0.8)';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('A SITE', 390, 190);

                // B Site
                ctx.fillStyle = 'rgba(255, 204, 0, 0.1)';
                ctx.fillRect(50, 500, 180, 180);
                ctx.fillStyle = 'rgba(255, 204, 0, 0.8)';
                ctx.fillText('B SITE', 140, 590);

                // Mid
                ctx.fillStyle = 'rgba(100, 100, 120, 0.1)';
                ctx.fillRect(250, 300, 100, 150);
                ctx.fillStyle = 'rgba(100, 100, 120, 0.8)';
                ctx.fillText('MID', 300, 375);
            }

            drawUtility() {
                const ctx = this.ctx;

                // Draw smokes
                this.smokes.forEach(smoke => {
                    if (this.currentTick >= smoke.startTick && this.currentTick <= smoke.endTick) {
                        const pos = this.worldToRadar(smoke.x, smoke.y);

                        const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, smoke.radius);
                        gradient.addColorStop(0, 'rgba(200, 200, 200, 0.7)');
                        gradient.addColorStop(0.5, 'rgba(180, 180, 180, 0.4)');
                        gradient.addColorStop(1, 'rgba(150, 150, 150, 0)');

                        ctx.fillStyle = gradient;
                        ctx.beginPath();
                        ctx.arc(pos.x, pos.y, smoke.radius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });

                // Draw mollies
                this.mollies.forEach(molly => {
                    if (this.currentTick >= molly.startTick && this.currentTick <= molly.endTick) {
                        const pos = this.worldToRadar(molly.x, molly.y);

                        const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, molly.radius);
                        gradient.addColorStop(0, 'rgba(255, 100, 0, 0.8)');
                        gradient.addColorStop(0.7, 'rgba(255, 50, 0, 0.5)');
                        gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');

                        ctx.fillStyle = gradient;
                        ctx.beginPath();
                        ctx.arc(pos.x, pos.y, molly.radius, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
            }

            drawPlayers() {
                const ctx = this.ctx;

                this.players.forEach(player => {
                    const pos = this.worldToRadar(player.x, player.y);
                    const radius = player.isAlive ? 14 : 8;

                    // Player colors
                    const color = player.team === 'CT' ? '#4a9eff' : '#ffcc00';
                    const deadColor = player.team === 'CT' ? 'rgba(74, 158, 255, 0.3)' : 'rgba(255, 204, 0, 0.3)';

                    if (!player.isAlive) {
                        // Dead player - X mark
                        ctx.strokeStyle = deadColor;
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(pos.x - 6, pos.y - 6);
                        ctx.lineTo(pos.x + 6, pos.y + 6);
                        ctx.moveTo(pos.x + 6, pos.y - 6);
                        ctx.lineTo(pos.x - 6, pos.y + 6);
                        ctx.stroke();
                        return;
                    }

                    // Flashed indicator
                    if (player.isFlashed) {
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                        ctx.beginPath();
                        ctx.arc(pos.x, pos.y, radius + 8, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // View direction cone
                    const angleRad = (player.angle - 90) * Math.PI / 180;
                    const coneLength = 40;
                    const coneWidth = 30 * Math.PI / 180;

                    ctx.fillStyle = player.team === 'CT' ? 'rgba(74, 158, 255, 0.2)' : 'rgba(255, 204, 0, 0.2)';
                    ctx.beginPath();
                    ctx.moveTo(pos.x, pos.y);
                    ctx.lineTo(
                        pos.x + Math.cos(angleRad - coneWidth) * coneLength,
                        pos.y + Math.sin(angleRad - coneWidth) * coneLength
                    );
                    ctx.lineTo(
                        pos.x + Math.cos(angleRad + coneWidth) * coneLength,
                        pos.y + Math.sin(angleRad + coneWidth) * coneLength
                    );
                    ctx.closePath();
                    ctx.fill();

                    // Player circle with gradient
                    const gradient = ctx.createRadialGradient(pos.x, pos.y, 0, pos.x, pos.y, radius);
                    gradient.addColorStop(0, color);
                    gradient.addColorStop(1, player.team === 'CT' ? '#2a5c99' : '#997700');

                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
                    ctx.fill();

                    // Border glow
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.shadowColor = color;
                    ctx.shadowBlur = 10;
                    ctx.stroke();
                    ctx.shadowBlur = 0;

                    // Slot number
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 11px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(player.slot.toString(), pos.x, pos.y);

                    // Health bar under player
                    const barWidth = 24;
                    const barHeight = 4;
                    const barY = pos.y + radius + 4;

                    // Background
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(pos.x - barWidth / 2, barY, barWidth, barHeight);

                    // Health fill
                    const healthColor = player.health > 50 ? '#44ff88' : player.health > 25 ? '#ffaa00' : '#ff4444';
                    ctx.fillStyle = healthColor;
                    ctx.fillRect(pos.x - barWidth / 2, barY, barWidth * (player.health / 100), barHeight);
                });
            }

            drawBomb() {
                const ctx = this.ctx;
                const bombPlayer = this.players.find(p => p.hasBomb && p.isAlive);

                if (bombPlayer) {
                    const pos = this.worldToRadar(bombPlayer.x, bombPlayer.y);

                    // Bomb indicator
                    const pulseScale = 1 + Math.sin(Date.now() / 200) * 0.1;

                    ctx.fillStyle = '#ff4444';
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y - 25, 6 * pulseScale, 0, Math.PI * 2);
                    ctx.fill();

                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 8px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('üí£', pos.x, pos.y - 24);
                }
            }

            worldToRadar(worldX, worldY) {
                const canvas = this.canvas;
                const config = this.mapConfig;

                // Normalize world coordinates to 0-1 range
                const rangeX = config.bounds.maxX - config.bounds.minX;
                const rangeY = config.bounds.maxY - config.bounds.minY;

                const normalX = (worldX - config.bounds.minX) / rangeX;
                const normalY = 1 - (worldY - config.bounds.minY) / rangeY; // Flip Y

                return {
                    x: normalX * canvas.width,
                    y: normalY * canvas.height
                };
            }

            updateTimeline() {
                const progress = (this.currentTick / this.totalTicks) * 100;
                document.getElementById('timeline-progress').style.width = `${progress}%`;

                const seconds = Math.floor(this.currentTick / this.tickRate);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('current-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            updateKillFeed() {
                const container = document.getElementById('kill-feed');
                container.innerHTML = '';

                // Show kills from last 5 seconds
                const recentKills = this.kills.filter(k =>
                    this.currentTick >= k.tick && this.currentTick - k.tick < 320 // 5 seconds
                );

                recentKills.forEach(kill => {
                    const entry = document.createElement('div');
                    entry.className = 'kill-entry';
                    entry.innerHTML = `
                        <span class="killer ${kill.killerTeam === 'T' ? 't-team' : ''}">${kill.killer}</span>
                        <span class="weapon">[${kill.weapon}]</span>
                        ${kill.headshot ? '<span class="headshot">‚¨§</span>' : ''}
                        <span class="victim">${kill.victim}</span>
                    `;
                    container.appendChild(entry);
                });
            }

            seekRound(direction) {
                // Move to next/prev round
                console.log(`Seek round: ${direction}`);
            }

            goToRound(roundNum) {
                console.log(`Go to round: ${roundNum}`);
                document.querySelectorAll('.round-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.round-btn')[roundNum - 1]?.classList.add('active');
                document.getElementById('current-round').textContent = roundNum;
            }
        }

        // Initialize
        const radar = new RadarReplayer();
    </script>
</body>

</html>